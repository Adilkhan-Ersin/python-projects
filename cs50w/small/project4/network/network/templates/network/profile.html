{% extends "network/layout.html" %}

{% block body %}
  {% comment %} Profile page {% endcomment %}
  <div class="" style="height: 100vh; width: 600px; border-right: 1px solid #dee2e6">

    {% comment %} Show username {% endcomment %}
    <div class="w-100 mt-5">
        <div class="d-flex justify-content-center align-items-center text-black" style="height: 60px">
          <h2 class="mt-0 mb-0">{{ username }}</h2>
        </div>
    </div>

    {% comment %} Follow/Unfollow {% endcomment %}
    {% if user.is_authenticated %}
      {% if user != userProfile %}
      <div class="d-flex justify-content-center align-items-center w-100" style="height: 60px">
        {% if isFollowing %}
          <form action="{% url 'unfollow' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="userfollow" value="{{ userProfile }}">
            <input type="submit" value="Unfollow" class="btn btn-primary">
          </form>
        {% else %}
          <form action="{% url 'follow' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="userfollow" value="{{ userProfile }}">
            <input type="submit" value="Follow" class="btn btn-primary">
          </form>
        {% endif %}
      </div>
      {% endif %}
    {% endif %}

    {% comment %} Show number of posts, followers, following {% endcomment %}
    <div class="p-2 d-flex justify-content-center align-items-center" style="height: 60px">
      <h4 class="mb-0 d-flex align-items-center">
        <div style="margin-right: 20px;">
          <strong>{{ allPosts.count }}</strong>
          <span class="text-muted">Posts</span>
        </div>
        <div style="margin-right: 20px;">
          <strong>{{ followers.count }}</strong>
          <span class="text-muted">Followers</span>
        </div>
        <div style="margin-right: 20px;">
          <strong>{{ following.count }}</strong>
          <span class="text-muted">Following</span>
        </div>
      </h4>
    </div>

    {% comment %} Recent posts {% endcomment %}
    <div class="py-2 mt-2" >
      <div class="d-flex mb-3 border-bottom">
        <h5 class="mb-0 px-2 pb-3">Recent posts</h5>
      </div>

      <div>
        {% for post in page_obj %}
            <div class="p-1 border-bottom">
              <div class="d-flex justify-content-between">
                <div class="d-flex">
                  <h5 class="p-2 m-0">
                    <a style="color: #000; text-decoration: none" href="{% url 'profile' user_id=post.user.id %}">{{ post.user }}</a>
                  </h5>
                  <a style="color: #000; text-decoration: none" class="pt-2 m-0" href="{% url 'profile' user_id=post.user.id %}">@{{ post.user }}</a>
                </div>
                <p class="m-0 align-self-center px-3" style="">{{ post.created_at }}</p>
              </div>
              <div class="px-3 ">
                <h6 class="m-0" id="post_{{ post.id }}">{{ post.content }}</h6>
              </div>
              {% comment %} Like and Edit button {% endcomment %}
              {% if user.is_authenticated %}
                {% if user == post.user %}
                <div class="d-flex justify-content-between py-2">
                  <div class="d-flex justify-content-end px-4 py-2">
                    <i class="btn btn-primary rounded-pill bi bi-pencil-square align-self-center" style="font-size: 16px; color: #fff; cursor: pointer;" data-bs-toggle="modal" data-bs-target="#editModal{{ post.id }}"></i>
                  </div>

                  <div class="modal fade" id="editModal{{ post.id }}" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title">Edit Post</h5>
                          <button type="button" class="btn btn-danger" data-bs-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg"></i></button>
                        </div>
                        <div class="modal-body">
                          <textarea rows="5" id="textarea_{{ post.id }}" class="form-control" name="content">{{ post.content }}</textarea>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-primary" onclick="submitHandler({{ post.id }})">Save changes</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}
                <div class="d-flex justify-content-end px-4 py-2">
                  <div class="d-flex align-items-center">
                    <i data-id="{{post.id}}" id="post-like-{{post.id}}" style="color: red; font-size: 24px; cursor: pointer;"
                    {% if not request.user in post.likes.all %} 
                      data-is_liked="false"
                      class="liked bi bi-heart"
                    {% else %} 
                      data-is_liked="true" 
                      class="liked bi bi-heart-fill"
                    {% endif %}></i>
                      <span class="p-2" style="font-size: 20px" id="post-count-{{post.id}}">{{ post.like_count }}</span>
                  </div>
                </div>             
              {% endif %}
            </div>
        {% endfor %}
      </div>
    </div>
    {% comment %} Pagination {% endcomment %}
    <nav aria-label="Page navigation example" class="d-flex justify-content-center">
      <ul class="pagination">
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
        {% endif %}

        {% for page in page_obj.paginator.page_range %}
          <li class="page-item"><a class="page-link" href="?page={{ page }}">{{ page }}</a></li>
        {% endfor %}

        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
        {% endif %}
      </ul>
    </nav>
  </div>
{% endblock %}