{% extends "auctions/layout.html" %}

{% block body %}
  <div class="container">
    {% if message %}
      {% if update %}
        <div class="alert alert-success" role="alert">
          {{ message }}
        </div>
      {% else %}
        <div class="alert alert-danger" role="alert">
          {{ message }}
        </div>
      {% endif %}
    {% endif %}
  </div>

  {% if not listing.isActive and user == listing.price.user %}
  <div class="alert alert-success" role="alert">
    Congratulations! You won this auction!
  </div>
  {% endif %}

  <div class="container-fluid row row-cols-2 justify-content-center">
    <div class="rounded col-2 p-3">
      <img  src="{{ listing.imageUrl }}" alt="{{ listing.title }}">
      {% if user.is_authenticated and listing.isActive %}
        <div class="container mt-4 d-flex">
          {% if watchlist %}
            <form action="{% url 'remove_watchlist' id=listing.id %}" method="POST">
              {% csrf_token %}
              <input type="submit" value="Remove from Watchlist" class="btn btn-danger">
            </form>
          {% else %}
            <form action="{% url 'add_watchlist' id=listing.id %}" method="POST">
              {% csrf_token %}
              <input type="submit" value="Add to Watchlist" class="btn btn-success">
            </form>
          {% endif %}
          {% if isOwner %}
            <form action="{% url 'closeAuction' id=listing.id %}" method="POST" class="mx-3">
              {% csrf_token %}
              <input type="submit" value="Close Auction" class="btn btn-danger">
            </form>
          {% endif %}
        </div>
      {% endif %}
    </div>
    <div class="col-3 py-4 px-5">
      <h2>{{ listing.title }}</h2>
      <p>{{ listing.description }}</p>
      <h3>${{ listing.price.bid }}</h3>
      <p>Listed by: {{ listing.owner }}</p>
      {% if user.is_authenticated %}
        <form action="{% url 'addBid' id=listing.id %}" method="POST">
          {% csrf_token %}
          <input type="number" min="0" name="newBid" placeholder="Add new bid">
          <input type="submit" value="Add" class="btn btn-success">
        </form>
      {% endif %}
    </div>

  </div>
  <div class="container-fluid justify-content-center w-50">
    <h2 class="mt-3">Comments</h2>
      {% if user.is_authenticated %}
        <form action="{% url 'addComment' id=listing.id %}" method="POST">
          {% csrf_token %}
          <input type="text" name="comment" placeholder="Enter a comment">
          <input type="submit" value="Add Comment" class="btn btn-success">
        </form>
      {% endif %}

      <ul class="list-group list-group-flush mt-4">
        {% for comment in comments %}
        <li class="list-group-item">
          <div class="ms-2 me-auto">
          <div class="fw-bold">{{ comment.author}}</div>
          <p class="m-0">{{ comment.comment }}</p>
        </div></li>
        {% endfor %}
      </ul>
  </div>
{% endblock %}
